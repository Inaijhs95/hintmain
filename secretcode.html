<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>?????</title>
  <style>
    body {
      background-color: #000;               /* 黒背景 */
      color: #39FF14;                       /* 蛍光グリーン */
      font-family: "Lucida Console", Courier, monospace; /* デジタル調フォント */
      text-align: center;
      padding: 40px;
    }
    h1 {
      font-size: 1.8em;
      margin-bottom: 20px;
    }
    input[type="text"] {
      background-color: #111;
      color: #39FF14;
      border: 1px solid #39FF14;
      padding: 10px;
      font-size: 1em;
      width: 200px;
      text-align: center;
    }
    button {
      background-color: #111;
      color: #39FF14;
      border: 1px solid #39FF14;
      padding: 10px 20px;
      font-size: 1em;
      margin-top: 10px;
      cursor: pointer;
    }
    button:hover {
      background-color: #39FF14;
      color: #000;
    }
    #analysis {
      margin-top: 20px;
      font-size: 0.9em;
      display: none;
      white-space: pre-wrap;
    }
    #resultLink {
      margin-top: 20px;
      display: none;
    }
    #errorMessage {CODE
      margin-top: 20px;
      color: #FF0000;
    }
  </style>
</head>
<body onload="initPage();">
  <h1>シークレットコードを入力してください</h1>
  <div id="codeInputArea">
    <input type="text" id="secretCode" placeholder="SECRET CODE">
    <br>
    <button onclick="checkCode()">ENTER</button>
  </div>
  <div id="errorMessage"></div>
  <div id="analysis"></div>
  <div id="resultLink">
    <button onclick="location.href='https://line.me/R/oaMessage/%40778unfqy/%E3%82%B7%E3%83%BC%E3%82%AF%E3%83%AC%E3%83%83%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E5%85%A5%E5%8A%9F%E3%81%AB%E6%88%90%E5%8A%9F%E3%81%97%E3%81%BE%E3%81%9F';">
      リンクにアクセス
    </button>
  </div>
  
  <script>
    // -------------------------------
    // 設定値
    // -------------------------------
    const CORRECT_CODE = "20250503";  // 正しいシークレットコード（半角）
    // ミス回数に応じた待機秒数（attempts: 1回目は0秒、2回目:10秒、3回目:30秒、4回目:60秒、5回目:300秒、6回目:900秒、7回目:1800秒、8回目:3600秒、9回目:10800秒、10回目:43200秒、11回目:86400秒、12回目:360000秒）
    const WAIT_TIMES = [0, 10, 30, 60, 300, 900, 1800, 3600, 10800, 43200, 86400, 360000];
    
    // 入力可能期限：2025年4月30日23:59:59（日本時間）
    const DEADLINE = new Date("2025-04-30T23:59:59+09:00");
    
    // localStorage用キー
    const STORAGE_KEY_ATTEMPTS = "secretCodeAttempts";
    const STORAGE_KEY_NEXT_ALLOW_TIME = "secretCodeNextAllow";
    
    // -------------------------------
    // ページ初期化
    // -------------------------------
    function initPage() {
      const now = new Date();
      if (now > DEADLINE) {
        document.body.innerHTML = "<h1>404 Error</h1><p>入力可能期間が終了しました。</p>";
        return;
      }
      checkLockState();
    }
    
    // -------------------------------
    // コードチェック処理
    // -------------------------------
    function checkCode() {
      const now = new Date();
      if (now > DEADLINE) {
        document.body.innerHTML = "<h1>404 Error</h1><p>入力可能期間が終了しました。</p>";
        return;
      }
      
      if (!canAttempt()) {
        return;
      }
      
      const inputVal = document.getElementById("secretCode").value.trim();
      
      // 正解判定（全角も考慮）
      if (inputVal === CORRECT_CODE || inputVal === "２０２５０５０３") {
        onCorrect();
      } else {
        onMistake();
      }
    }
    
    // -------------------------------
    // 正解時の処理：解析演出＆リンク表示
    // -------------------------------
    function onCorrect() {
      document.getElementById("codeInputArea").style.display = "none";
      document.getElementById("errorMessage").innerText = "";
      
      const analysisArea = document.getElementById("analysis");
      analysisArea.style.display = "block";
      
      let counter = 0;
      const maxCount = 50; // 更新回数が一定に達したら解析完了
      const intervalId = setInterval(() => {
        analysisArea.innerText = getRandomString(60);
        counter++;
        if (counter > maxCount) {
          clearInterval(intervalId);
          analysisArea.innerText = "データ解析が完了しました。";
          document.getElementById("resultLink").style.display = "block";
        }
      }, 50);
    }
    
    // -------------------------------
    // 入力ミス時の処理：待機時間設定＆エラー表示
    // -------------------------------
    function onMistake() {
      let attempts = getAttempts() + 1;
      setAttempts(attempts);
      
      const waitSec = getWaitSecondsForAttempt(attempts);
      const now = new Date();
      if (waitSec > 0) {
        const nextAllow = now.getTime() + waitSec * 1000;
        setNextAllowTime(nextAllow);
      } else {
        setNextAllowTime(0);
      }
      
      document.getElementById("errorMessage").innerText = attempts + "回ミスしました。";
      if (waitSec > 0) {
        alert(attempts + "回ミス: " + waitSec + "秒後に再度入力できます。");
      }
      checkLockState();
    }
    
    // -------------------------------
    // ロック状態のチェック＆UI更新
    // -------------------------------
    function checkLockState() {
      const errorElem = document.getElementById("errorMessage");
      const inputArea = document.getElementById("codeInputArea");
      
      const nowTime = new Date().getTime();
      const nextAllow = getNextAllowTime();
      
      if (nowTime < nextAllow) {
        const remainSec = Math.ceil((nextAllow - nowTime) / 1000);
        errorElem.innerText = "ただいま待機中です。あと " + remainSec + "秒 お待ちください。";
        inputArea.style.display = "none";
        setTimeout(checkLockState, 1000);
      } else {
        errorElem.innerText = "";
        inputArea.style.display = "block";
      }
    }
    
    // -------------------------------
    // 入力可能かどうかの判定
    // -------------------------------
    function canAttempt() {
      const nowTime = new Date().getTime();
      const nextAllow = getNextAllowTime();
      if (nowTime < nextAllow) {
        const remainSec = Math.ceil((nextAllow - nowTime) / 1000);
        document.getElementById("errorMessage").innerText = "あと " + remainSec + "秒 待ってから再度入力してください。";
        return false;
      }
      return true;
    }
    
    // -------------------------------
    // ミス回数に応じた待機秒数を取得
    // -------------------------------
    function getWaitSecondsForAttempt(attempts) {
      if (attempts <= WAIT_TIMES.length) {
        return WAIT_TIMES[attempts - 1];
      } else {
        return WAIT_TIMES[WAIT_TIMES.length - 1];
      }
    }
    
    // -------------------------------
    // localStorage の getter/setter
    // -------------------------------
    function getAttempts() {
      const val = localStorage.getItem(STORAGE_KEY_ATTEMPTS);
      return val ? parseInt(val, 10) : 0;
    }
    
    function setAttempts(value) {
      localStorage.setItem(STORAGE_KEY_ATTEMPTS, value);
    }
    
    function getNextAllowTime() {
      const val = localStorage.getItem(STORAGE_KEY_NEXT_ALLOW_TIME);
      return val ? parseInt(val, 10) : 0;
    }
    
    function setNextAllowTime(value) {
      localStorage.setItem(STORAGE_KEY_NEXT_ALLOW_TIME, value);
    }
    
    // -------------------------------
    // ランダムな英数字文字列生成ユーティリティ
    // -------------------------------
    function getRandomString(length) {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      let result = "";
      for (let i = 0; i < length; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }
  </script>
</body>
</html>
