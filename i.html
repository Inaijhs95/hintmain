<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ニセモノ探しゲーム</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f0f0f0;
      margin: 0;
      padding: 20px;
    }
    #gameContainer {
      max-width: 400px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .option {
      display: inline-block;
      margin: 10px;
      padding: 15px 20px;
      background: #eee;
      border-radius: 4px;
      cursor: pointer;
      font-size: 24px;
      user-select: none;
    }
    .option:hover {
      background: #ddd;
    }
    button {
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <!-- メッセージ・オプション表示用 -->
    <div id="message"></div>
    <div id="options"></div>
  </div>

  <script>
    // 【設定】
    // 正解の元文字（5文字） ※最初のミニゲームで「下記の５つをタッチするとクリア」として示されたもの
    const realChars = ["升", "并", "弁", "＃", "丼"];
    // 正解は「realChars」の各ターンで1文字を抜いた4文字列（例：ターン1なら「并弁＃丼」、ターン2なら「升弁＃丼」など）
    // ダミー用フェイク文字（計15文字）
    const fakeSourceStrings = ["卉介开刋丌", "末无廿元爿", "ヰ丰尺卅廾"];
    // fakePool: 各文字を個別に配列化
    let fakePool = [];
    fakeSourceStrings.forEach(str => {
      fakePool = fakePool.concat(str.split(''));
    });
    
    // ゲームの状態管理
    let currentTurn = 0;
    const totalTurns = 5;
    let currentCorrect = "";

    const messageDiv = document.getElementById("message");
    const optionsDiv = document.getElementById("options");
    
    // 初期画面：説明文とスタートボタン
    function showStartScreen() {
      messageDiv.innerHTML = "<h2>稲井に紛れていたニセモノを見つけろ</h2>";
      optionsDiv.innerHTML = "";
      const startBtn = document.createElement("button");
      startBtn.textContent = "START";
      startBtn.addEventListener("click", startGame);
      optionsDiv.appendChild(startBtn);
    }
    
    // ゲーム開始
    function startGame() {
      currentTurn = 0;
      nextTurn();
    }
    
    // 各ターンの正解文字列を生成
    // ここでは、ターンごとに realChars のうち、順番に1文字を除外した4文字列を正解とする
    function getCorrectString(turn) {
      // 0～4のturn番号に応じ、該当のインデックスを除外
      return realChars.filter((ch, index) => index !== turn).join('');
    }
    
    // fake文字列生成：fakePool からランダムに4文字を選ぶ
    function generateFakeString() {
      let fake = "";
      for (let i = 0; i < 4; i++) {
        const randIndex = Math.floor(Math.random() * fakePool.length);
        fake += fakePool[randIndex];
      }
      return fake;
    }
    
    // 配列をシャッフルする関数
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    
    // ターン開始：正解とフェイク3つを作成し表示
    function nextTurn() {
      // クリア済みの場合
      if (currentTurn >= totalTurns) {
        gameClear();
        return;
      }
      
      // ターン表示（例：「ターン1 / 5」）
      messageDiv.innerHTML = `<h2>ターン ${currentTurn+1} / ${totalTurns}</h2>`;
      optionsDiv.innerHTML = "";
      
      // 正解文字列生成
      currentCorrect = getCorrectString(currentTurn);
      
      // オプション作成：正解1件＋フェイク3件
      let options = [];
      options.push({text: currentCorrect, correct: true});
      
      // フェイクは、正解と重複しないように生成
      while(options.length < 4) {
        let fakeText = generateFakeString();
        // もし偶然正解と一致してしまったら再生成
        if (fakeText === currentCorrect) continue;
        options.push({text: fakeText, correct: false});
      }
      
      // シャッフルして表示
      options = shuffleArray(options);
      options.forEach(opt => {
        const btn = document.createElement("div");
        btn.className = "option";
        btn.textContent = opt.text;
        btn.addEventListener("click", () => { optionClicked(opt); });
        optionsDiv.appendChild(btn);
      });
    }
    
    // オプションクリック時の処理
    function optionClicked(option) {
      if (option.correct) {
        currentTurn++;
        nextTurn();
      } else {
        gameOver();
      }
    }
    
    // ゲームオーバー処理
    function gameOver() {
      messageDiv.innerHTML = "<h2>ゲームオーバー</h2>";
      optionsDiv.innerHTML = "";
      const retryBtn = document.createElement("button");
      retryBtn.textContent = "再チャレンジ";
      retryBtn.addEventListener("click", showStartScreen);
      optionsDiv.appendChild(retryBtn);
    }
    
    // ゲームクリア処理：報酬リンクへ誘導
    function gameClear() {
      messageDiv.innerHTML = "<h2>クリア！</h2>";
      optionsDiv.innerHTML = "";
      const rewardBtn = document.createElement("button");
      rewardBtn.textContent = "報酬を受け取る";
      // 指定のLINEリンクへ遷移
      rewardBtn.addEventListener("click", () => {
        window.location.href = "https://line.me/R/oaMessage/%40778unfqy/%E3%81%93%E3%82%8D%E3%81%93%E3%82%8D%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F";
      });
      optionsDiv.appendChild(rewardBtn);
    }
    
    // 初期画面表示
    showStartScreen();
  </script>
</body>
</html>
